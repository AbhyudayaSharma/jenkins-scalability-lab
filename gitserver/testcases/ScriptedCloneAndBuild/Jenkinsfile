node {
    // TODO:
    // We need to add a withCredentials(whatever) thing to use the credential 
    // for the username `git`. That Credential is already on Jenkins, just have to 
    // write it into this Jenkinsfile the right way.
    withEnv(["JAVA_HOME=${ tool 'jdk8' }", "PATH+MAVEN=${tool 'maven'}/bin:${env.JAVA_HOME}/bin"]) {
    
    // def mvnHome = tool 'maven'
    // def java = tool 'jdk8'
    
    stage ('Sanity Check') {
        echo "Where is maven?"
        sh "which mvn"
        echo "Where is java?"
        sh "which java"
    }
    
    stage('Check out') { 
        // Can probably get by with putting the credential thing here.
        // Two ways to do it:
        //   git credentialsID: 'git-ssh', url: 'ssh://git@gitserver/git-server/repos/simple-maven-project-with-tests.git'
        //   - or - 
        //   withCredentials(put-the-credentials-id-here) { 
        //       git url: 'ssh://git@gitserver/git-server/repos/simple-maven-project-with-tests.git' 
        //   }
        // git url: 'ssh://git@gitserver/git-server/repos/simple-maven-project-with-tests.git'
        git (credentialsID: "git", url: "ssh://git@gitserver/git-server/repos/simple-maven-project-with-tests.git")
        // withCredentials('git') {
        //     git url: 'ssh://git@gitserver/git-server/repos/simple-maven-project-with-tests.git'
        // }
    }
    
    stage('Build it') {
        sh "'${mvnHome}/bin/mvn' -Dmaven.test.failure.ignore clean package"
    }
    
    stage('Archive our results') {
        junit '**/target/surefire-reports/TEST-*.xml'
        archive 'target/*.jar'
    }
}

}